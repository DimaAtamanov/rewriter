# Рерайт статей и генерация изображений

## Описание скрипта

Скрипт содержится в файле *rewriter_script.py*. На вход подается файл с таблицей, в которой содержатся ссылки на статьи. 
Поддерживаются следующие разрешения: .csv, .xls, .xlsx, .xlsm, .xlsb, .odf, .ods, .odt.
Работа скрипта основана на нейросетевой модели от ПАО СберБанк [GigaChat](https://developers.sber.ru/portal/products/gigachat).

Каждый url адрес в таблице обрабатывается по следующему сценарию:

1. Извлечение текста стаьи
2. Разбиение статьи на части, обусловленные ограничениями модели
3. Рерайтинг текста
4. Разбиение текста после рерайта на параграфы
5. Суммаризация каждого параграфа
6. Генерация изображения к каждому параграфу на основе суммаризации

Все стаьи сохраняются в файл с названием *rewrite_result.md*
Изображения сохраняются в директорию *img_for_article*. Для каждой статьи формируется своя поддиректория.
В файле *rewrite_result.md* к каждой статье указывается путь к файлу с изображениями к этой статье.

**ВНИМАНИЕ! Скрипт перезаписывает указанные файлы и директории при каждом запуске. Не забывайте сохранять результат работы скрипта**

## Как использовать

1. Скачать скрипт *rewriter_script.py*
2. Создать в директории со скриптом файл *.env*
3. В файле *.env* указать свой API токен
```python
GIGACHAT_API_PERS = 'Ваш токен'
```
4. Запустить скрипт и следовать инструкции

**ВНИМАНИЕ! Следите, чтобы файл .env не попал в публичный доступ**

Подробно о том как получить токен и о GigaChat API в целом см. [официальную документацию](https://developers.sber.ru/docs/ru/gigachat/api/overview)

Если возникают ошибки проверки сертификата укажите в вызове функции `main` параметры `verify_ssl_certs=False`, `verify=False`.

Также во время выполнения программы могут возникать ошибки связанные с выполнением запросов к модели.
Сама модель также может прерывать генерацию по отдельным обращениям из-за внутренних парвил.
Такие прерывания сопровождаются логами `Giga generation stopped with reason: blacklist`

Для анализа результатов работы скрипта эти моменты нужно отслеживать.
